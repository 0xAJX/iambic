<table>
    <thead>
        <tr>
            <th>Template ID</th>
            <th>Account</th>
            <th>Resource Type</th>
            <th>Resource ID</th>
            <th>Action</th>
            <th>Proposed Change</th>
        </tr>
    </thead>
    <tbody>
        {% for template_id, template_data in resource_changes|groupby('template_id') -%}
            {% for account, account_data in template_data|groupby('accounts') -%}
        <tr class="accordion-toggle">
            <td rowspan="{{ account_data|length }}">{{ template_id }}</td>
            <td>{{ ", ".join(account) }}</td>
            <td>{{ account_data[0]['resource_type'] }}</td>
            <td>{{ account_data[0]['resource_id'] }}</td>
            <td>{{ account_data[0]['action'] }}</td>
            <td>{{ account_data[0]['proposed_change'] }}</td>
        </tr>
            {% for row in account_data[1:] -%}
        <tr class="accordion-toggle">
            <td>{{ account }}</td>
            <td>{{ row['resource_type'] }}</td>
            <td>{{ row['resource_id'] }}</td>
            <td>{{ row['action'] }}</td>
            <td>{{ row['proposed_change'] }}</td>
        </tr>
            {% endfor -%}
            {% endfor -%}
        {% endfor -%}
    </tbody>
</table>