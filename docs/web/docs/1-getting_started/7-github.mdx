---
title: Deploy on GitHub
---

### Configuring GitHub to work with IAMbic
These steps will guide you through the process of setting up an IAMOps/GitOps workflow using
GitHub Actions and an IAMbic Lambda function.

:::note

The instructions below leverage GitHub Action hosted runners. Github bills usage of action runners to the nearest full minute.
You can find more details [here](https://docs.github.com/en/billing/managing-billing-for-github-actions/about-billing-for-github-actions).
To avoid being charged, you might consider using self-hosted runners. Alternatively, you can reduce the frequency of your IAMbic
action runs by changing their schedules after you have completed the setup process below.

:::

<!--

This is experimental, WIP code.

To makes these commands easier to copy and paste, we recommend filling out the following variables:

GitHub Organization: <input
type="text"
id="inputGithubOrg"
defaultValue="exampleOrg"
onInput={(e) => {
  updateText('outputGithubOrg', e.target.value)
  updateText('outputGithubOrgLink', getGitOrganizationLink(e.target.value), true)
  }
}
/>

IAMbic AWS Hub Account Name: <input
type="text"
id="inputAWSHubAccount"
defaultValue="aws_hub_account" onInput={(e) => {
  updateText('outputAWSHubAccount', e.target.value)
  }
}
/>

import CodeBlockWithLabel from '@site/src/components/CodeBlockWithLabel';

<div>
  GitHub Organization:
  <input
    type="text"
    id="inputGithubOrg"
    defaultValue="exampleOrg"
    onInput={(e) => {
      updateText('outputGithubOrg', e.target.value);
      updateText('outputGithubOrgLink', getGitOrganizationLink(e.target.value), true);
    }}
  />
</div>

<div>
  IAMbic AWS Hub Account Name:
  <input
    type="text"
    id="inputAWSHubAccount"
    defaultValue="aws_hub_account"
    onInput={(e) => {
      updateText('outputAWSHubAccount', e.target.value);
    }}
  />
</div>

<CodeBlockWithLabel
  code={`template_type: NOQ::AWS::IAM::Role
included_accounts:
  - {outputAWSHubAccount}
  - {aws_account_1_label}
  - {aws_account_2_label}
...`}
  language="language-yaml"
  labels={[
    { id: 'outputAWSHubAccount', content: 'AWS Hub Account' },
    { id: 'aws_account_1_label', content: 'AWS Account 1' },
    { id: 'aws_account_2_label', content: 'AWS Account 2' },
  ]}
/>




 - import CodeBlockWithLabel from '@site/src/components/CodeBlockWithLabel';

Pre CodeBlockWithLabel

<CodeBlockWithLabel
  code={`template_type: NOQ::AWS::IAM::Role
included_accounts:
  - {outputAWSHubAccount}
  - {aws_account_1_label}
  - {aws_account_2_label}
...`}
  language="language-yaml"
  labels={[
    { id: 'outputAWSHubAccount', content: 'AWS Hub Account' },
    { id: 'aws_account_1_label', content: 'AWS Account 1' },
    { id: 'aws_account_2_label', content: 'AWS Account 2' },
  ]}
/>

Post CodeBlockWithLabel

Pre-link

<a href={getGitOrganizationLink('exampleOrg')} target="_blank" id={elementIds.gitHubOrgAnchorTag}><label id='outputGithubOrgLink'>{getGitOrganizationLink('exampleOrg')}</label></a>

Post-Link

-->


## Overview
IAMbic's GitHub integration is designed to facilitate team collaboration on IAMbic templates.
This page will walk you through the steps of configuring IAMbic, GitHub, and AWS to work together.

### Compatible versions of Github

 * GitHub Free
 * GitHub Team
 * Github Enterprise Cloud

### The typical workflow for using IAMbic with GitHub

![IAMbic Git Flow](/img/git/iambic_git_flow.png)

1. Developer Alice wants to create an application role. She creates a different branch, makes her changes, and submits a pull request with her changes to the IAMbic templates repository.
2. Once the PR is created, the IAMbic GitHub action will run `iambic plan --git-aware` to calculate the changes required due to the PR, and submits the proposed changes back into the PR as a comment.
3. Reviewer Bob will review the template changes along with the proposed_changes. Bob may request additional changes.
4. Optional: Developer Alice updates the PR. The IAMbic GitHub action will run `iambic plan --git-aware` again to calculate the new changes required.
5. Reviewer Bob approves the PR.
6. Developer Alice comments with `iambic apply` in the PR.
7. The IAMbic GitHub action will apply the changes in the PR.
8. Once git-apply is successful, the GitHub action will close the pull request.

:::tip

If you'd like to use IAMbic in multiple AWS partitions (For example, AWS GovCloud, AWS China, and AWS Commercial),
you will need to create a separate IAMbic repository and GitHub App for each partition.

:::

## Setting up GitHub and AWS to work with IAMbic

### Prerequisites
Before you begin, you will need to do the following:

1. Complete the [IAMbic Getting Started guide](/getting_started/) to create your Git repository and import your existing identities and
permissions from your cloud provider(s).
2. Set up a GitHub repository for your IAMbic templates.
3. Make sure you have admin access for the IAMbic GitHub repository that can perform the following tasks:
	1. Configure the repository to require approvals before Merging Pull Requests.
	2. Add GitHub Apps
4. Have AWS admin rights to deploy IAMbic GitHub integration.

#### Set up a GitHub repository for your IAMbic templates

1. Log in to [GitHub](https://github.com/login?return_to=https%3A%2F%2Fgithub.com%2Fsettings%2Forganizations)
1. Visit this [link](https://github.com/noqdev/github-iambic-templates/generate) to create a `iambic-templates` repository in your GitHub organization.
Remember to set the visibility setting to `Private`. This repository will store IAMbic templates for your organization. <!-- #TODO include a picture or video -->

If you prefer to use `gh` (GitHub command line [interface](https://cli.github.com/manual/), here is the command)

```bash
export ORG_NAME=YOUR_GITHUB_ORG_NAME
gh repo create "${ORG_NAME}/iambic-templates" \
  --private --template noqdev/github-iambic-templates
```

#### Set up a GitHub repository for your IAMbic integration summaries

1. Log in to [GitHub](https://github.com/login?return_to=https%3A%2F%2Fgithub.com%2Fsettings%2Forganizations)
1. Visit this [link](https://github.com/noqdev/github-iambic-templates-gist/generate) to create a `iambic-templates-gist` repository in your GitHub organization.
Remember to set the visibility setting to `Private`. This repository will store IAMbic integration summaries for your organization. <!-- #TODO include a picture or video -->

If you prefer to use `gh` (GitHub command line [interface](https://cli.github.com/manual/), here is the command)

```bash
export ORG_NAME=YOUR_GITHUB_ORG_NAME
gh repo create "${ORG_NAME}/iambic-templates-gist" \
  --private --template noqdev/github-iambic-templates-gist
```

:::note

The gist repository must have the same name as your IAMbic templates repository, with `-gist` appended to the end.
For example, if your repository name is `iambic-templates`, the new repository must be named `iambic-templates-gist`.

:::

## GitHub App integration

By installing IAMbic GitHub App, the app can integrate the pull-request and merge flow in your iambic templates repository.


### Create a GitHub App in your organization

* You need GitHub org admin right to create GitHub app for your org
* You need AWS admin right that can assume IambicHubRole in the management account and AWS admin right to deploy the IAMbic GitHub integration.

```bash
iambic setup
```

* Select `Setup GitHub App Integration using AWS Lambda` option

:::note

What the above command is doing is the following:

1. Using GitHub App manifest creation flow to create a GitHub App in your GitHub organization.
1. Download the private key and webhook secret to your host. `~/.iambic/.github_secrets.yaml`
1. Create the needed IAM roles in the targeted AWS account.
1. Create the needed ECR Pull Through Cache rule
1. Create the needed ECR Repo to store your own copy of the `iambic` container image
1. Create the needed CodeBuild project to pull initial iambic image from Public ECR Gallery to your own ECR repo
1. Create the needed Lambda function and function url to receive webhook events for your GitHub app
1. Update your GitHub app webhook url to point at the lambda function url.

:::

If you like to follow a video walk through, click on the below video.

[![Setup IAMbic GitHub Integration](https://img.youtube.com/vi/3PikJZ0pW8A/0.jpg)](https://youtu.be/3PikJZ0pW8A)



## Install your GitHub app and grant access to your IAMbic repositories

1. The previous step should have brought to your GitHub App Install page.
1. Select both `iambic-templates` and `iambic-templates-gist` for repository access.


#### Open a pull request on your iambic-template repo

1. `default_branch=$(git symbolic-ref refs/remotes/origin/HEAD | sed 's@^refs/remotes/origin/@@')`
2. `git checkout -b task/change_description "$default_branch"`
3. Edit one of your description within your templates, like `resources/github/iam_role_lambda.yaml`. <!-- #TODO edit to what?? -->
4. Add your changes to your branch, and push it to github:
	```bash
	git add resources/github/iam_role_lambda.yaml
	git commit -m "Change Description"
	git push origin HEAD
	```
5. Create a pull request.
6. The installed GitHub App will comment with plan the changes. Any time you want iambic github action to re-plan the changes, you can comment `iambic plan`.
7. The plan will be a comment in line, as long as it is less than 65kb. Larger plans are uploaded to a gist and linked as a comment in the PR
8. Add reviewers to review your PR and plan that is in the PR comments.
9. Once your reviewer approves your changes, add comment `iambic apply` to have iambic apply the changes. If the changes can be successfully applied, the PR will be automatically merged into main as well.


#### Configure your GitHub Repository to require approvals before merging

1. Go to the GitHub repository you had created previously, `ExampleOrg/iambic-templates`
2. Navigate to Repository Settings, in the left navigation menu to "Branches" settings page; the URL will look something like `github.com/ExampleOrg/iambic-templates/settings/branches`

![IAMbic Git Flow](/img/git/github-settings-menu.png)

3. Add a branch protection rule.
4. Set the branch name pattern to `main` (Or the name of your default branch, if it isn't `main`).
5. Configure the options
	1. Enable "Require a pull request before merging".
	1. Enable "Require Approvals".
	1. Leave the default value for "Required number of approvals".
	1. Enable "Require status checks to pass before merging". <!-- #TODO Is there a reason the prior 3 settings were on one line and this was on it's own line?  -->

### Enable iambic-integrations to bypass review rules for default branch


In the typical review flow for pull requests, approval from reviewers is necessary. However, certain actions like auto import or auto expiration
involve pushing changes back to the default branch without requiring manual approvals.

1. Go to your iambic templates repository settings (https://github.com/ExampleOrg/ExampleIambicTemplatesRepository/settings).
2. Click "Branches" in the top left navigation.
3. Click on "Edit" for your default branch (typically "main" or "master") under "Branch protection rules".
4. Click on "Allow specified actors to bypass required pull requests".
5. In "Search for people, teams or apps", type in `iambic-integrations` to click on the GitHub App we have created.
6. Click "Save changes".

### Finish setting up your local repo

<!--

## FAQ

1. The process of executing the plan and apply operations follows a merge workflow.
Initially, the default branch (usually  origin/main or origin/master) is checked out,
and the requested changes from the pull request are merged into it. This ensures that
the plan reflects the most current state. If conflicts arise at any point, the requester
should pull their default branch into the pull request branch and let the IAMbic GitHub
action replan the changes accordingly.

2. Do I need a dedicated GitHub account to run IAMbic?

	A: #TODO

3. Can I use my existing GitHub repos to run IAMbic?

	A: #TODO

4. Can I set IAMbic to run on just a small portion of my cloud? How do I do that?

	A: #TODO

5. How do I debug the GitHub App?

	A: #TODO

6. How do I update the GitHub App Lambda?

	A: #TODO

-->
